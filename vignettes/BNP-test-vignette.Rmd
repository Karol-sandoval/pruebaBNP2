---
title: "Performing the BNP Testing procedure for paired samples"
author:
- "Kevin Ortiz Gonzalez"
- "Karol Michelle Sandoval"
date: "April 2022"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Performing the BNP Testing procedure for paired samples}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```


It is very common to want to determine the effects that a given intervention or treatment has on a set of individuals, which is why statistical methods such as hypothesis tests are used, such as hypothesis tests, including the well-known Student's t-test. However, on many occasions the parametric assumptions are not fulfilled and for this reason we resort to the nonparametric field where we find the Wilcoxon signed-rank test, but which can also present inconveniences in the presence of negative correlation where the power of the test is affected, which has led many researchers to seek solutions in other fields of statistics, such as Pereira et al. (2020) who proposed a hypothesis test for paired samples that is framed in the field of Bayesian nonparametric statistics and makes the assumptions of traditional tests more flexible, in addition to comparing distributions in their entirety and not only by location and scale parameters.

In this order of ideas, the BNP.test function was implemented in R, which allows the Bayesian nonparametric hypothesis test to be carried out in a functional way for the user, since only one vector with the observations before the intervention or treatment (x), another vector with the observations after the intervention (y) and finally, the number of simulations that the user wishes to carry out must be entered.


To illustrate how the test works, an example with simulated data and one with real data will be presented. In the case of simulated data, it will be performed from a normal mixture and in the case of real data, the $datasets$ package and the $airquality$ database will be used.


## Example 1 

For this dataset, the statistical simulation of a bivariate normal mixture with mean vectors and variance and covariance matrices given by:

$$
(1) \hspace{0.5cm} Y \sim N_2 \left(\begin{array}{cc} 
0 \\
-3
\end{array}\right)
\left(\begin{array}{cc} 
1 & 0.8\\ 
0.8 & 1
\end{array}\right)
$$
$$
(2) \hspace{0.5cm} Y \sim N_2 \left(\begin{array}{cc} 
0 \\
3
\end{array}\right)
\left(\begin{array}{cc} 
1 & 0.8\\ 
0.8 & 1
\end{array}\right)
$$
Where a set of n simulated random values of an uniform distribution of parameters $(0,1)$ is taken and if it is less than 0.5 it is sampled from the first distribution and otherwise from the second distribution.

```{r bnp1}
library(BNPPairedSamples) #package library load

#Simulation of the data

set.seed(123)
y <- matrix(runif(300), ncol = 300)

y <- apply(y, 2, function(i) if (i < 0.5) {
  y <- rmvnorm(1, mean = c(0, -3), sigma = matrix(c(1,0.8,0.8,1),nrow = 2,byrow = T))
}else{
  y <- rmvnorm(1, mean = c(0,3), sigma = matrix(c(1,0.8,0.8,1),nrow = 2,byrow = T))
})

y <- t(y)

```

After loading the package library and loading the data, we proceed to run the BNP.test function.


```{r bnp2}

test_results <- BNP.test(x=y[,1], y=y[,2], n.mcm = 10000)

```

The BNP.test function returns a list with 3 elements, where the first element corresponds to the parameters obtained by Gibbs sampling, the second element shows the posterior probability of the alternative hypothesis and the third element corresponds to the raw data.


```{r bnp3}

test_results[[1]][1:3]
  
test_results$posterior.probability.H1
  
test_results$data.init

```

From the hypothesis test and the marginal distributions it can be said that there are significant differences at the level of shape, scale and location.


## Example 2

The $airquality$ database from the $datasets$ library is used for this example. The data are longitudinal but the months of May and August were taken to work as paired data and only the wind column was taken, which corresponds to average wind speed data in miles per hour at La Guardia Airport between 7:00 a.m. and 10:00 a.m.


```{r bnp4}


#Simulation of the data

library(datasets)
data("airquality")

before_air_data <- airquality[airquality$Month==5,3]
after_air_data <- airquality[airquality$Month==8,3]

```

Now, we proceed to run the function after loading the data.

```{r bnp5}


test_results <- BNP.test(x=before_air_data, y=after_air_data, n.mcm = 10000)

```

Finally, it is observed from the result of the hypothesis test that there seem to be significant differences; however, it is up to each researcher to determine if the probability between 0.5 and 0.6 is significant or not. As for the graph, it could be said that there are no significant differences at the level of shape and scale, but there are differences at the level of location, since the means are different from each other. 
